meta:
  environment: jvm
  toolchain:
    name: maven
    version: "17"
build:
  image: maven:3.8.6-eclipse-temurin-17
  args: null
  artifacts:
    target/*.jar: /
run:
  image: eclipse-temurin:17.0.6_10-jre-jammy
  jarName: app.jar
  args: -XX:+UseZGC -XX:+ZUncommitDelay=300 -XX:ZCollectionInterval=30 -XX:+HeapDumpOnOutOfMemoryError -Djava.security.egd=file:/dev/./urandom
  persistenceMount: /data
  containerPort: "8080"
  servicePort: "80"
  env:
    PORT: ${PORT}
    LOG_LEVEL: ${LOG_LEVEL}

    CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS}
    CORS_ALLOWED_METHODS: ${CORS_ALLOWED_METHODS}
    CORS_ALLOWED_HEADERS: ${CORS_ALLOWED_HEADERS}
    CORS_ALLOW_CREDENTIALS: ${CORS_ALLOW_CREDENTIALS}
    CORS_MAX_AGE: ${CORS_MAX_AGE}

    POSTGRES_URL: ${POSTGRES_URL}
    POSTGRES_USERNAME: ${POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}

    JWT_ACCESS_TOKEN_SECRET: ${JWT_ACCESS_TOKEN_SECRET}
    JWT_ACCESS_TOKEN_LIFETIME: ${JWT_ACCESS_TOKEN_LIFETIME}
    JWT_REFRESH_TOKEN_SECRET: ${JWT_REFRESH_TOKEN_SECRET}
    JWT_REFRESH_TOKEN_LIFETIME: ${JWT_REFRESH_TOKEN_LIFETIME}

    MAIL_HOST: ${MAIL_HOST}
    MAIL_PORT: ${MAIL_PORT}
    MAIL_USERNAME: ${MAIL_USERNAME}
    MAIL_PASSWORD: ${MAIL_PASSWORD}

    MAIL_VERIFICATION_DURATION_IN_MINUTES: ${MAIL_VERIFICATION_DURATION_IN_MINUTES}

    INTERNAL_REQUEST_SECRET: ${INTERNAL_REQUEST_SECRET}

    RATE_LIMIT_WHITE_LIST: ${RATE_LIMIT_WHITE_LIST}
    RATE_LIMIT_CAPACITY: ${RATE_LIMIT_CAPACITY}
    RATE_LIMIT_REFILL_TOKENS: ${RATE_LIMIT_REFILL_TOKENS}
    RATE_LIMIT_REFILL_SECONDS: ${RATE_LIMIT_REFILL_SECONDS}

    JPA_OPEN_IN_VIEW: ${JPA_OPEN_IN_VIEW}
    SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE}
healthcheck:
  path: /actuator/health
  interval: 30
  timeout: 5